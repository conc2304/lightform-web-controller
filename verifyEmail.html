<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Verifying Email Address</title>

</head>

<body>
	<script src="js/config.js"></script>
	<script type="application/javascript">
		async function init() {
			await loadConfig();

			fetch(config().apiUrl + '/users/me/email/verification', {
				method: 'put',
				headers: {
					'Authorization': `X-Email-Verify ${window.location.hash.replace('#', '')}`
				}
			})
			.then(async response => {
				let json = await response.json();

				if(response.ok) {
					localStorage.setItem('accessToken', json.access_token);
					window.location.href = 'register.html';
				} else {
					window.location.href = `login.html#message=${encodeURIComponent(json.message)}`
				}
			});
		}

		init();
	</script>
</body>
</html>
